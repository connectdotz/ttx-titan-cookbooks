# NOTE:
# This file has been modified to use private_dns_name for 127.0.0.1, instead of locahost
#
# The original file is in: 
#    https://github.com/aws/opsworks-cookbooks/blob/master-chef-11.4/opsworks_stack_state_sync/templates/default/hosts.erb
# Current OpsWorks recommendation for template override:
#   http://docs.aws.amazon.com/opsworks/latest/userguide/workingcookbook-template-override.html. 
#
# Not a great solution since it won't inherient the future change OpsWorks might make to this file, had to keep an eye on this
# file from now and keep up with the changes.
#
# ======= Original Below =========
# This file was generated by OpsWorks
# any manual changes will be removed on the next update.

127.0.0.1 localhost localhost.localdomain

# ==== change begin =====
<%= node[:opsworks][:instance][:private_ip] %> <%= node[:opsworks][:instance][:private_dns_name] %>
# ==== change end =====

# The following lines are desirable for IPv6 capable hosts
::1 ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ff02::3 ip6-allhosts

# OpsWorks Layer State
127.0.0.1 <%= node[:opsworks][:instance][:hostname] %>.localdomain <%= node[:opsworks][:instance][:hostname] %>
<% seen = [] -%>
<% node[:opsworks][:layers].each do |layer_name, layer_config| -%>
<% layer_config[:instances].each do |instance_name, instance_config| -%>
<% if !seen.include?(instance_name) && instance_config[:private_ip] -%>
<%= Resolv.getaddress(instance_config[:private_ip]) %> <%= instance_config[:private_dns_name] %>
<%= Resolv.getaddress(instance_config[:private_ip]) %> <%= instance_name %>
<% if instance_config[:ip] %>
<%= Resolv.getaddress(instance_config[:ip]) %> <%= instance_config[:public_dns_name] %>-ext
<%= Resolv.getaddress(instance_config[:ip]) %> <%= instance_name %>-ext
<% end %>
<% seen << instance_name %>
<% end -%>
<% end -%>
<% end -%>